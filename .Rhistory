# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.align = 'center', fig.path = './figs/diffs_sg_issr/')
knitr::opts_chunk$set(cache.extra = R.version.string)
# Chunk 2
options("rgdal_show_exportToProj4_warnings"="none")
library(XML)            # various XML utilities
library(jsonlite)       # JSON protocol
library(RCurl)          # access via URL
library(rgdal)          # GDAL access from R
library(gdalUtils)      # wrappers for GDAL utility programs that could be
#  called from the command line
library(sf)             # spatial data types
library(terra)          # raster data, replaces `raster`
library(raster)         # `terra` sometimes blows up, then use this
# Chunk 3
base.dir <- "/Users/rossiter/ds/"
base.dir.landgis <- paste0(base.dir, "LandGIS")
base.dir.import <- "/Volumes/Pythagoras/ds/"
base.dir.landgis.import <- paste0(base.dir.import, "LandGIS")
# Chunk 4
voi.list.landgis <- c("clay.wfraction_usda.3a1a1a",
"silt.wfraction_usda.3a1a1a",
"sand.wfraction_usda.3a1a1a",
"ph.h2o_usda.4c1a2a",
"organic.carbon_usda.6a1c",
"bulkdens.fineearth_usda.4a1h",
"coarsefrag.vfraction_usda_3b1")
voi.list.landgis.code <- c(1476854, 2525675, 1476851,
1475459, 1475457, 1475970,
2525681)
voi.list.sg <- c("clay", "silt", "sand", "phh2o", "soc",  "bdod", "cfvo")
# Chunk 5
voi.n <- 4
voi.sg <- voi.list.sg[voi.n]
voi.landgis <- voi.list.landgis[voi.n]
voi.landgis.code <- voi.list.landgis.code[voi.n]
# Chunk 6
depth.list.landgis <- c("0", "10", "30", "60", "100", "200")
# Chunk 7
depth <- 1
depth.landgis <- paste0("b", depth.list.landgis[depth], "..", depth.list.landgis[depth], "cm")
# Chunk 8: lrc
tile.lrc <- c(-76, 42)   # lower-right corner
tile.size <- 1
# Chunk 9: ulc
tile.ulc <- c(tile.lrc[1]-tile.size, tile.lrc[2]+tile.size) # upper-left corner
# Chunk 10
AOI.dir.prefix <- paste0("lat", tile.lrc[2], tile.ulc[2],
"_lon", tile.ulc[1], tile.lrc[1])
# Chunk 11
AOI.dir.prefix <- paste0("lat", tile.lrc[2], tile.ulc[2],
"_lon", tile.ulc[1], tile.lrc[1])
# Chunk 12: zenodo.new
(filename.in <- paste0(base.dir.landgis.import,
"/sol_", voi.landgis,
"_m_250m_", depth.landgis,
"_1950..2017_v0.2.tif"))
if (!file.exists(filename.in)) {
system.time(
download_zenodo(paste0("10.5281/zenodo.",voi.landgis.code),
path=base.dir.landgis.import,
logger="INFO")
)
}
# Chunk 13: in.slice1
r.landgis <- terra::rast(filename.in)
print(r.landgis)
# Chunk 14
m <- matrix(c(tile.ulc[1],tile.lrc[1],  #ulc
tile.ulc[2], tile.lrc[2]),  #lrc
nrow=2)
bb.ll <- st_sfc(st_multipoint(m))
st_crs(bb.ll) <- 4326
(dest.dir.landgis <-  paste0(base.dir.landgis, "/", AOI.dir.prefix))
if (!dir.exists(dest.dir.landgis)) {
dir.create(dest.dir.landgis, recursive = TRUE)}
(file.name <- paste0(voi.psu, "_", depth.sg))
(file.name <- paste0(voi.landgis, "_", depth))
depth <- 1
depth.landgis <- depth.list.landgis[depth]
depth.landgis.suffix <- paste0("b", depth.landgis, "..", depth.list.landgis[depth], "cm")
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.align = 'center', fig.path = './figs/diffs_sg_issr/')
knitr::opts_chunk$set(cache.extra = R.version.string)
# Chunk 2
options("rgdal_show_exportToProj4_warnings"="none")
library(XML)            # various XML utilities
library(jsonlite)       # JSON protocol
library(RCurl)          # access via URL
library(rgdal)          # GDAL access from R
library(gdalUtils)      # wrappers for GDAL utility programs that could be
#  called from the command line
library(sf)             # spatial data types
library(terra)          # raster data, replaces `raster`
library(raster)         # `terra` sometimes blows up, then use this
# Chunk 3
base.dir <- "/Users/rossiter/ds/"
base.dir.landgis <- paste0(base.dir, "LandGIS")
base.dir.import <- "/Volumes/Pythagoras/ds/"
base.dir.landgis.import <- paste0(base.dir.import, "LandGIS")
# Chunk 4
voi.list.landgis <- c("clay.wfraction_usda.3a1a1a",
"silt.wfraction_usda.3a1a1a",
"sand.wfraction_usda.3a1a1a",
"ph.h2o_usda.4c1a2a",
"organic.carbon_usda.6a1c",
"bulkdens.fineearth_usda.4a1h",
"coarsefrag.vfraction_usda_3b1")
voi.list.landgis.code <- c(1476854, 2525675, 1476851,
1475459, 1475457, 1475970,
2525681)
voi.list.sg <- c("clay", "silt", "sand", "phh2o", "soc",  "bdod", "cfvo")
# Chunk 5
voi.n <- 4
voi.sg <- voi.list.sg[voi.n]
voi.landgis <- voi.list.landgis[voi.n]
voi.landgis.code <- voi.list.landgis.code[voi.n]
# Chunk 6
depth.list.landgis <- c("0", "10", "30", "60", "100", "200")
# Chunk 7
depth <- 1
depth.landgis <- depth.list.landgis[depth]
depth.landgis.suffix <- paste0("b", depth.landgis, "..", depth.list.landgis[depth], "cm")
# Chunk 8: lrc
tile.lrc <- c(-76, 42)   # lower-right corner
tile.size <- 1
# Chunk 9: ulc
tile.ulc <- c(tile.lrc[1]-tile.size, tile.lrc[2]+tile.size) # upper-left corner
# Chunk 10: zenodo.new
(filename.in <- paste0(base.dir.landgis.import,
"/sol_", voi.landgis,
"_m_250m_", depth.landgis.suffix,
"_1950..2017_v0.2.tif"))
if (!file.exists(filename.in)) {
system.time(
download_zenodo(paste0("10.5281/zenodo.",voi.landgis.code),
path=base.dir.landgis.import,
logger="INFO")
)
}
# Chunk 11: in.slice1
r.landgis <- terra::rast(filename.in)
print(r.landgis)
# Chunk 12
m <- matrix(c(tile.ulc[1],tile.lrc[1],  #ulc
tile.ulc[2], tile.lrc[2]),  #lrc
nrow=2)
bb.ll <- st_sfc(st_multipoint(m))
st_crs(bb.ll) <- 4326
bb.vect <- as.vector(matrix(st_bbox(bb.ll), nrow=2, byrow=T))
bb.ll.ext <- ext(bb.vect)
AOI.dir.prefix <- paste0("lat", tile.lrc[2], tile.ulc[2],
"_lon", tile.ulc[1], tile.lrc[1])
(dest.dir.landgis <-  paste0(base.dir.landgis, "/", AOI.dir.prefix))
if (!dir.exists(dest.dir.landgis)) {
dir.create(dest.dir.landgis, recursive = TRUE)}
(file.name <- paste0(voi.landgis, "_", depth.landgis))
f <- writeRaster(r.landgis.crop, file=paste0(dest.dir.landgis,"/",
file.name, ".tiff"),
overwrite=TRUE, wopt=list(gdal=c("TFW=YES")),
filetype="GTiff")
(file.name <- paste0(voi.landgis, "_", depth.landgis))
version
